---
interface Todo {
  id: string;
  text: string;
  completed: boolean;
}

const initialTodos: Todo[] = [
  { id: '1', text: 'Learn Astro', completed: false },
  { id: '2', text: 'Build a TODO app', completed: false },
  { id: '3', text: 'Deploy to production', completed: false },
];
---

<div class="max-w-md mx-auto mt-8">
  <h2 class="text-2xl font-bold mb-4">Todo List</h2>
  <ul id="todo-list" class="space-y-2">
    {initialTodos.map((todo) => (
      <li class="flex items-center space-x-2" data-id={todo.id}>
        <input
          type="checkbox"
          id={todo.id}
          checked={todo.completed}
          class="form-checkbox h-5 w-5 text-blue-600"
        />
        <label for={todo.id} class={`${todo.completed ? 'line-through text-gray-500' : ''}`}>
          {todo.text}
        </label>
      </li>
    ))}
  </ul>
</div>

<script>
  let todos = [
    { id: '1', text: 'Learn Astro', completed: false },
    { id: '2', text: 'Build a TODO app', completed: false },
    { id: '3', text: 'Deploy to production', completed: false },
  ];

  const todoList = document.getElementById('todo-list');

  function renderTodos() {
    todoList.innerHTML = todos.map(todo => `
      <li class="flex items-center space-x-2" data-id="${todo.id}">
        <input
          type="checkbox"
          id="${todo.id}"
          ${todo.completed ? 'checked' : ''}
          class="form-checkbox h-5 w-5 text-blue-600"
        />
        <label for="${todo.id}" class="${todo.completed ? 'line-through text-gray-500' : ''}">
          ${todo.text}
        </label>
      </li>
    `).join('');

    attachEventListeners();
  }

  function attachEventListeners() {
    todoList.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', (e) => {
        const id = e.target.id;
        const todo = todos.find(t => t.id === id);
        if (todo) {
          todo.completed = e.target.checked;
          renderTodos();
        }
      });
    });
  }

  document.addEventListener('newtodo', (e) => {
    todos.push(e.detail);
    renderTodos();
  });

  renderTodos();
</script>
